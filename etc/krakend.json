{
  "$schema": "https://www.krakend.io/schema/v2.4/krakend.json",
  "version": 3,
  "endpoints": [
    {
      "endpoint": "/api/login/",
      "method": "POST",
      "backend": [
        {
          "url_pattern": "/login/",
          "host": ["http://localhost:5200"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/signer": {
          "alg": "RS256",
          "kid": "access-token-key",
          "keys_to_sign": ["access_token", "refresh_token"],
          "jwk_local_path": "./etc/private_key.json",
          "disable_jwk_security": true
        }
      }
    },
    {
      "endpoint": "/api/register/",
      "method": "POST",
      "backend": [
        {
          "url_pattern": "/register/",
          "host": ["http://localhost:5200"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ]
    },
    {
      "_comment": "Registra 1: Set auto enrollment",
      "endpoint": "/api/auto-enrollment/",
      "method": "PUT",
      "backend": [
        {
          "url_pattern": "/auto-enrollment/",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Registra"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true
        }
      }
    },
    {
      "_comment": "Registra 2: Creates a new course with the provided details.",
      "endpoint": "/api/courses/",
      "method": "POST",
      "backend": [
        {
          "url_pattern": "/courses/",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Registra"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true
        }
      }
    },
    {
      "_comment": "Registra 3: Creates a new section.",
      "endpoint": "/api/sections/",
      "method": "POST",
      "backend": [
        {
          "url_pattern": "/sections/",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Registra"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true
        }
      }
    },
    {
      "_comment": "Registra 4: Deletes a specific section.",
      "endpoint": "/api/sections/{id}",
      "method": "DELETE",
      "backend": [
        {
          "url_pattern": "/sections/{id}",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Registra"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true
        }
      }
    },
    {
      "_comment": "Registra 5: Updates specific details of a section.",
      "endpoint": "/api/sections/{id}",
      "method": "PATCH",
      "backend": [
        {
          "url_pattern": "/sections/{id}",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Registra"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true
        }
      }
    },
    {
      "_comment": "Student 1: Retreive all available classes.",
      "endpoint": "/api/classes/available/",
      "method": "GET",
      "backend": [
        {
          "url_pattern": "/classes/available/",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Student"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true
        }
      }
    },
    {
      "_comment": "Student 2: Student enrolls in a section",
      "endpoint": "/api/enroll/",
      "method": "POST",
      "input_headers": ["x-cwid", "x-first-name", "x-last-name"],
      "backend": [
        {
          "url_pattern": "/enroll/",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Student"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true,
          "propagate_claims": [
            ["jti", "x-cwid"],
            ["first_name", "x-first-name"],
            ["last_name", "x-last-name"]
          ]
        }
      }
    },
    {
      "_comment": "Student 3: Student drop a class",
      "endpoint": "/api/enrollment/{section_id}/",
      "method": "DELETE",
      "input_headers": ["x-cwid"],
      "backend": [
        {
          "url_pattern": "/enrollment/{section_id}/",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Student"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true,
          "propagate_claims": [["jti", "x-cwid"]]
        }
      }
    },
    {
      "_comment": "Student 4: View current waitlist position",
      "endpoint": "/api/sections/{section_id}/waitlistposition/",
      "method": "GET",
      "input_headers": ["x-cwid"],
      "backend": [
        {
          "url_pattern": "/sections/{section_id}/waitlistposition/",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Student"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true,
          "propagate_claims": [["jti", "x-cwid"]]
        }
      }
    },
    {
      "_comment": "Instructor 1: Retreive current enrollment for the classes.",
      "endpoint": "/api/classes/{section_id}/students/",
      "method": "GET",
      "input_headers": ["x-cwid"],
      "backend": [
        {
          "url_pattern": "/classes/{section_id}/students/",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Instructor"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true,
          "propagate_claims": [["jti", "x-cwid"]]
        }
      }
    },
    {
      "_comment": "Instructor 2: Retreive students who have dropped the class.",
      "endpoint": "/api/classes/{section_id}/droplist/",
      "method": "GET",
      "input_headers": ["x-cwid"],
      "backend": [
        {
          "url_pattern": "/classes/{section_id}/droplist/",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Instructor"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true,
          "propagate_claims": [["jti", "x-cwid"]]
        }
      }
    },
    {
      "_comment": "Instructor 3: Drop students administratively.",
      "endpoint": "/api/enrollment/{section_id}/{student_id}/administratively/",
      "method": "DELETE",
      "input_headers": ["x-cwid"],
      "backend": [
        {
          "url_pattern": "/enrollment/{section_id}/{student_id}/administratively/",
          "host": ["http://localhost:5100"],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["Instructor"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true,
          "propagate_claims": [["jti", "x-cwid"]]
        }
      }
    },
    {
      "endpoint": "/api/students/classes/{class_id}",
      "method": "DELETE",
      "input_headers": ["x-cwid"],
      "backend": [
        {
          "url_pattern": "/students/classes/{class_id}",
          "host": [
            "http://localhost:5000",
            "http://localhost:5001",
            "http://localhost:5002"
          ],
          "extra_config": {
            "backend/http": {
              "return_error_details": "backend_b"
            }
          }
        }
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "roles_key": "roles",
          "roles": ["registrar", "student", "instructor"],
          "jwk_local_path": "./etc/public_key.json",
          "disable_jwk_security": true,
          "operation_debug": true,
          "propagate_claims": [["jti", "x-cwid"]]
        }
      }
    }
  ]
}
